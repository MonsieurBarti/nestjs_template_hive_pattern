# AI Quick Reference

> **Purpose**: Fast lookup for AI agents. All details live in other docs - this just points you there.

## ğŸ¯ Project Type

**NestJS Modular Monolith** with Hexagonal Architecture + CQRS + Hive Pattern

## ğŸ“ Key Documentation

| Document                                                     | Purpose                             | When to Read                   |
| ------------------------------------------------------------ | ----------------------------------- | ------------------------------ |
| [`README.md`](README.md)                                     | Project overview, setup, tech stack | First time setup               |
| [`GETTING_STARTED.md`](GETTING_STARTED.md)                   | Step-by-step tutorial               | Creating your first feature    |
| [`src/modules/ARCHITECTURE.md`](src/modules/ARCHITECTURE.md) | Concepts & structure (the "why")    | Understanding the architecture |
| [`src/modules/AI_AGENTS.md`](src/modules/AI_AGENTS.md)       | Rules, conventions, workflow        | Before writing any code        |
| [`src/modules/AI_TEMPLATES.md`](src/modules/AI_TEMPLATES.md) | Copy-paste code templates           | Implementing features          |

## âš¡ Quick Workflows

Located in `.agent/workflows/`:

- [`/create-feature`](.agent/workflows/create-feature.md) - Create new module from scratch
- [`/add-command`](.agent/workflows/add-command.md) - Add write operation
- [`/add-query`](.agent/workflows/add-query.md) - Add read operation
- [`/run-tests`](.agent/workflows/run-tests.md) - Run and debug tests

## ğŸ›‘ Critical Rules

> See [`AI_AGENTS.md`](src/modules/AI_AGENTS.md) for complete rules

1. **Every endpoint** must use `@CorrelationId()`
2. **Never** use `console.log` - use injected `BaseLogger`
3. **Commands** return `void`, **Queries** return data
4. **Always** use Zod with `@ZodSchema`, never `class-validator`
5. **All endpoints** must have Swagger decorators

## ğŸ“ Module Structure

```
src/modules/[feature]/
â”œâ”€â”€ domain/[entity]/           # Business logic (pure TS)
â”‚   â”œâ”€â”€ [entity].ts
â”‚   â””â”€â”€ [entity].repository.ts
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ commands/              # Write (void)
â”‚   â””â”€â”€ queries/               # Read (data)
â”œâ”€â”€ infrastructure/[entity]/   # Adapters
â”‚   â”œâ”€â”€ in-memory-[entity].repository.ts
â”‚   â””â”€â”€ sql-[entity].repository.ts
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ dto/
â”œâ”€â”€ [feature].module.ts
â””â”€â”€ [feature].tokens.ts
```

## ğŸ”§ Common Commands

```bash
# Development
npm run start:dev

# Testing
npm run test              # Run once
npm run test:watch        # Watch mode
npm run test:ui           # UI mode

# Code Quality
npm run lint
npm run format

# Build
npm run build
```

## ğŸ¨ Code Templates

All templates in [`AI_TEMPLATES.md`](src/modules/AI_TEMPLATES.md):

1. Domain Entity
2. Repository Interface
3. InMemory Repository (testing)
4. SQL Repository + Mapper
5. Command + Handler
6. Query + Handler
7. Controller
8. DTO (Zod)
9. Domain Entity Test
10. Command Handler Test
11. Query Handler Test
12. Domain Event
13. Exception Filter
14. Integration Test
15. Mapper Test

## ğŸ“¦ Example Module

See `src/modules/article/` for complete working example with:

- Domain entity with business logic
- InMemory repository
- Command (CreateArticle)
- Query (GetArticle)
- Controller with Swagger
- Full test coverage

## ğŸ” Finding Code

```bash
# Find all commands
find src/modules -name "*.command.ts"

# Find all queries
find src/modules -name "*.query.ts"

# Find all tests
find src/modules -name "*.spec.ts"
```

## ğŸš¨ Common Mistakes

| Mistake                       | Fix                                    |
| ----------------------------- | -------------------------------------- |
| Command returns data          | Commands must return `void`            |
| Missing `@CorrelationId()`    | Add to every controller method         |
| Using `class-validator`       | Use Zod with `@ZodSchema`              |
| Business logic in handler     | Move to domain entity                  |
| Importing across modules      | Use Hive Pattern (see ARCHITECTURE.md) |
| Mocking repositories in tests | Use InMemory implementations           |

## ğŸ¯ Decision Tree

### Should I create a Command or Query?

- **Writing data?** â†’ Command (returns `void`)
- **Reading data?** â†’ Query (returns data)

### Where does this logic go?

- **Business rules?** â†’ Domain Entity
- **Orchestration?** â†’ Command/Query Handler
- **Data transformation?** â†’ Mapper
- **HTTP concerns?** â†’ Controller
- **Validation?** â†’ Zod Schema

### How do I access another module?

- **Never** import directly
- **Use** Hive Pattern (In-Proc interfaces)
- **See** `ARCHITECTURE.md` section 4

## ğŸ“Š Tech Stack

- **Framework**: NestJS 10
- **Language**: TypeScript 5 (strict mode)
- **Testing**: Vitest
- **Validation**: Zod
- **Documentation**: Swagger/OpenAPI
- **Logging**: Pino
- **CQRS**: @nestjs/cqrs

## ğŸ”— External Resources

- [NestJS Docs](https://docs.nestjs.com/)
- [Zod Docs](https://zod.dev/)
- [Vitest Docs](https://vitest.dev/)
- [Hexagonal Architecture](https://alistair.cockburn.us/hexagonal-architecture/)

---

**Remember**: This is just a quick reference. Always read the detailed docs for complete understanding.
